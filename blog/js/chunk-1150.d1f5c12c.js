(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1150"],{"E15+":function(s,t,n){"use strict";n.r(t);var e={created:function(){}},a=n("psIG"),v=Object(a.a)(e,function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"blog-container"},[e("BlogHeader",{attrs:{title:"关于一个需求的解决思路",subTitle:"",date:"2019-01-09",tags:["Javascript"]}}),s._v(" "),e("BlogContent",[e("div",{attrs:{slot:"content"},slot:"content"},[e("h2",[s._v("前言")]),s._v(" "),e("p",[s._v("\n                在面试的最后阶段，如果候选人给我的感觉不错的话，我经常会问这样一个问题：\n                ")]),e("blockquote",[e("p",[s._v("\n                        刚才你说到，用过一段时间 xxx 框架，xx API属性也用过，也很清楚它达到的效果。\n                    ")]),s._v(" "),e("br"),s._v(" "),e("p",[s._v("\n                        那么现在，如果需要你实现一个类似的效果，抛开 xxx 框架以及 xx API属性，"),e("br"),s._v("你会如何去实现，有没有思路？\n                    ")])]),s._v(" "),e("p"),s._v(" "),e("p",[e("strong",[s._v("这是一道开放题，没有标准答案")]),s._v("。这个问题，在于考量候选人的思维方式和解决问题的能力，以及把他思考的过程，阐述清楚的表达能力。这 3 种能力，往往比使用过某些框架的经验，更让我看中。\n            ")]),s._v(" "),e("h2",[s._v("一个小需求")]),s._v(" "),e("p",[s._v("\n                昨天，老板给我提了个小需求，需要实现让我们自己定制的弹出层，具备按下 ESC 也能退出的功能。我想了下，觉得并不复杂，就交给了同组的小伙伴去实现。我们的某个项目用到了vue技术栈，以及饿了么的UI框架。\n            ")]),s._v(" "),e("p",[s._v("\n                我开完会回来，发现他还在处理那个功能，但好像遇到了什么瓶颈。于是，我就问了他卡在了什么地方。\n            ")]),s._v(" "),e("p",[s._v("\n                小伙伴说，他百度了不少资料，还查了官方文档，并且尝试其中的办法，但就是无法触发按下esc的回调方法，很是郁闷。我看了他的代码，他的写法是这样的：\n                "),e("pre",{staticClass:"hljs scala"},[e("code",[s._v("<div "),e("span",{staticClass:"hljs-class"},[e("span",{staticClass:"hljs-keyword"},[s._v("class")])]),s._v("="),e("span",{staticClass:"hljs-string"},[s._v('"custom-modal"')]),s._v(" "),e("span",{staticClass:"hljs-meta"},[s._v("@keydown")]),e("span",{staticClass:"hljs-number"},[s._v(".27")]),s._v("="),e("span",{staticClass:"hljs-string"},[s._v('"handlePressEscape"')]),s._v(">"),e("br"),s._v("    ..."),e("br"),s._v("</div>")])]),s._v(" "),e("pre",{staticClass:"hljs r"},[e("code",{},[e("span",{staticClass:"hljs-keyword"},[s._v("...")]),e("br"),s._v("handlePressEscape () {"),e("br"),s._v("    console.log("),e("span",{staticClass:"hljs-string"},[s._v("'press escape!'")]),s._v(");"),e("br"),s._v("},"),e("br"),e("span",{staticClass:"hljs-keyword"},[s._v("...")])])]),s._v("\n\n                他的想法不错，因为是自定义的弹出层，所以就想着把 keydown 事件，绑定在最外层的 div 上，让整个弹出层都能监听到。\n            ")]),s._v(" "),e("p",[s._v("\n                他给我看了他查的资料，几乎都是 input 上绑定 keydown 事件的例子，而vue的官方文档里也是类似的例子，所以陷入了瓶颈。但是他忽略了一个问题，"),e("strong",[s._v("keydown 事件，并非绑在任意一个标签上都会起作用")]),s._v("。\n            ")]),s._v(" "),e("h2",[s._v("一个思路")]),s._v(" "),e("p",[s._v("\n                我没有直接把答案告诉他，而是给他提供了一个思路：在我们常用的 element-ui 的 el-dialog组里，有个属性叫做 "),e("code",[s._v("close-on-press-escape")]),s._v("，它的解释如下图：\n                "),e("img",{attrs:{src:n("QVWo")}})]),s._v(" "),e("p",[s._v("\n                从文档的解释，可以看出 el-dialog 在默认情况下，已经实现了我们需要解决的需求。所以，我让他看看 el-dialog 的源码，是如何实现的。\n            ")]),s._v(" "),e("p",[s._v("\n                他一听要看源码，就懵了。源码一词，乍一听就是神秘、高大上、吊炸天的代名词。回想当初，我也曾对它有一股莫名的恐慌情绪，所以我有点理解小伙伴现在的心情。于是，我对他说，不要慌，我们只要找到解决问题的关键部分就行了，源码没有那么不可怕，我们一起来找找看。\n            ")]),s._v(" "),e("h2",[s._v("查找源码")]),s._v(" "),e("p",[s._v("\n                首先，我们在 node_modules 里，找到了 element-ui的文件夹，它大致长这个样子：\n                "),e("img",{attrs:{src:n("H5gy")}}),s._v("\n\n                接着，我们找到了 packages 里的 dialog 文件夹，再从 index 入口，找到了组件 component.vue。点进去找了半天，也只找到个 "),e("strong",[s._v("closeOnPressEscape")]),s._v(" 属性的定义，却没有实现的方法。\n\n                "),e("pre",{staticClass:"hljs scala"},[e("code",{},[s._v("..."),e("br"),s._v("closeOnPressEscape: {"),e("br"),s._v("    "),e("span",{staticClass:"hljs-class"},[e("span",{staticClass:"hljs-keyword"},[s._v("type")])]),s._v(": "),e("span",{staticClass:"hljs-type"},[s._v("Boolean")]),s._v(","),e("br"),s._v("    "),e("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(": "),e("span",{staticClass:"hljs-literal"},[s._v("true")]),e("br"),s._v("},"),e("br"),s._v("...")])]),s._v("\n\n                这么神奇么？只定义一个属性，就能实现一个事件的交互了？\n            ")]),s._v(" "),e("p",[s._v("\n                感觉不太可能，为了揭开迷雾，继续找。。。\n            ")]),s._v(" "),e("p",[s._v("\n                仔细浏览了 component.vue 文件，发现在 script 里，引入下面 3 个文件：\n                "),e("pre",{staticClass:"hljs typescript"},[e("code",{},[e("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" Popup "),e("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),e("span",{staticClass:"hljs-string"},[s._v("'element-ui/src/utils/popup'")]),s._v(";"),e("br"),e("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" Migrating "),e("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),e("span",{staticClass:"hljs-string"},[s._v("'element-ui/src/mixins/migrating'")]),s._v(";"),e("br"),e("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" emitter "),e("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),e("span",{staticClass:"hljs-string"},[s._v("'element-ui/src/mixins/emitter'")]),s._v(";"),e("br"),s._v("...")])]),s._v("\n                在第一个引入的 Popup 中，竟然也发现了 "),e("strong",[s._v("closeOnPressEscape")]),s._v("，感觉似乎找对方向了。\n            ")]),s._v(" "),e("p",[s._v("\n                令人沮丧的是，Popup 中同样只有 "),e("strong",[s._v("closeOnPressEscape")]),s._v(" 的属性定义，却没有实现。但是它却引入了另一个辅助文件 "),e("strong",[s._v("PopupManager")]),s._v("。\n            ")]),s._v(" "),e("p",[s._v("\n                哇！终于找到了！原来它的实现，是这样的：\n                "),e("pre",{staticClass:"hljs javascript"},[e("code",{},[e("span",{staticClass:"hljs-comment"},[s._v("// handle `esc` key when the popup is shown")]),e("br"),e("span",{staticClass:"hljs-built_in"},[s._v("window")]),s._v(".addEventListener("),e("span",{staticClass:"hljs-string"},[s._v("'keydown'")]),s._v(", "),e("span",{staticClass:"hljs-function"},[e("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),e("span",{staticClass:"hljs-params"},[s._v("event")]),s._v(") ")]),s._v("{"),e("br"),s._v("    "),e("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (event.keyCode === "),e("span",{staticClass:"hljs-number"},[s._v("27")]),s._v(") {"),e("br"),s._v("        "),e("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" topPopup = getTopPopup();"),e("br"),e("br"),s._v("        "),e("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (topPopup && topPopup.closeOnPressEscape) {"),e("br"),s._v("            topPopup.handleClose"),e("br"),s._v("                ? topPopup.handleClose()"),e("br"),s._v("                : (topPopup.handleAction"),e("br"),s._v("                    ? topPopup.handleAction("),e("span",{staticClass:"hljs-string"},[s._v("'cancel'")]),s._v(")"),e("br"),s._v("                    : topPopup.close());"),e("br"),s._v("        }"),e("br"),s._v("    }"),e("br"),s._v("});")])]),s._v("\n                原来，是在 window 上添加了事件监听 keydown，当监测到是 ESC 的 keyCode 时，则执行相关操作。\n            ")]),s._v(" "),e("h2",[s._v("模仿源码")]),s._v(" "),e("p",[s._v("\n                ok，现在已经知晓了原理，那就按照我们的实际需求，模仿改造一下：\n                "),e("pre",{staticClass:"hljs kotlin"},[e("code",{},[s._v("..."),e("br"),s._v("props: {"),e("br"),s._v("    ..."),e("br"),s._v("    closeOnPressEscape: {"),e("br"),s._v("        type: "),e("span",{staticClass:"hljs-built_in"},[s._v("Boolean")]),s._v(","),e("br"),s._v("        "),e("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(": "),e("span",{staticClass:"hljs-literal"},[s._v("true")]),e("br"),s._v("    }"),e("br"),s._v("},"),e("br"),s._v("..."),e("br"),s._v("mounted () {"),e("br"),s._v("    window.addEventListener("),e("span",{staticClass:"hljs-string"},[s._v("'keydown'")]),s._v(", "),e("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".handlePressEscape);"),e("br"),s._v("},"),e("br"),e("br"),s._v("destroyed () {"),e("br"),s._v("    window.removeEventListener("),e("span",{staticClass:"hljs-string"},[s._v("'keydown'")]),s._v(", "),e("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".handlePressEscape);"),e("br"),s._v("},"),e("br"),e("br"),s._v("methods: {"),e("br"),s._v("    ..."),e("br"),s._v("    handlePressEscape (event) {"),e("br"),s._v("        "),e("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),e("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".closeOnPressEscape && event.keyCode === "),e("span",{staticClass:"hljs-number"},[s._v("27")]),s._v(") {"),e("br"),s._v("            "),e("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".handleClose();"),e("br"),s._v("        }"),e("br"),s._v("    }"),e("br"),s._v("}")])]),s._v("\n                在上述实现中，有2个需要注意的点：\n                "),e("ul",[e("li",[s._v("代码方面，在 mounted 中，给 window 添加事件监听之后，要记得在 destroyed 时，去除监听。")]),s._v(" "),e("li",[s._v("业务方面，这是一个我们定制的通用的弹出层组件，所以在 props 中定义了一个 closeOnPressEscape 属性，以方便在某些业务场景下，不需要按 ESC 就退出这个功能的时候，直接设置它为 false 即可。")])])]),s._v(" "),e("h2",[s._v("总结")]),s._v(" "),e("p",[s._v("\n                虽然这是个不复杂的小需求，但在解决问题的过程中，百度和文档无法给予帮助的情况下，我们开拓了新的思路，转向研究“源码”，尽管也曾因两次都没找到实现方法而感到沮丧，但最终我们还是找到解决方案，并且学到了其背后的原理。\n            ")]),s._v(" "),e("p",[s._v("\n                另外，一个值得我们每个开发者思考的问题是：现代框架的确降低入门的门槛，提高的开发效率，但"),e("strong",[s._v("有一天，如果脱离了框架和它的API，我们学到了什么，掌握了什么？以至于，当下一个更新更棒的框架出现的时候，能够用这些学到的掌握的能力，迅速地上手")]),s._v("。我觉得，那比仅仅可以熟练地使用一门框架，要实用的多了。\n            ")])])])],1)},[],!1,null,null,null);v.options.__file="thinking-of-solution.vue";t.default=v.exports},H5gy:function(s,t,n){s.exports=n.p+"assets/bg-20190109-02.2eb00df.png"},QVWo:function(s,t){s.exports="data:image/png;base64,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"}}]);