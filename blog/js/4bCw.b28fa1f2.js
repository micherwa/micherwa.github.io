(window.webpackJsonp=window.webpackJsonp||[]).push([["4bCw"],{"4bCw":function(s,a,t){"use strict";t.r(a);var v={created:function(){}},n=t("psIG"),l=Object(n.a)(v,function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"blog-container"},[t("BlogHeader",{attrs:{title:"浅谈 发布/订阅 模式",subTitle:"",date:"2017-08-22",tags:["Javascript"]}}),s._v(" "),t("BlogContent",{attrs:{useCatalog:!1}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("p",[s._v("\n                定义：一个目标对象管理所有相依于它的观察者对象，并且在它本身的状态改变时主动发出通知。这通常透过呼叫各观察者所提供的方法来实现。此种模式通常被用来实时事件处理系统。\n            ")]),s._v(" "),t("p",[s._v("\n                它有2个参与者：发布者和订阅者。发布者向某个信道发布一条消息，订阅者绑定这个信道，当有消息发布至信道时就会接收到一个通知。\n            ")]),s._v(" "),t("p",[s._v("\n                最重要的一点是， 发布者和订阅者是完全解耦的，彼此并不知晓对方 的存在。两者仅仅共享一个信道名称。\n            ")]),s._v(" "),t("p",[s._v("\n                一个简单的观察者模式：（一个事件只绑定一个操作，取消订阅时把整个事件都删掉）\n                "),t("pre",{staticClass:"hljs javascript"},[t("code",{},[t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" PubSub = ("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" eventObj = {};"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" {"),t("br"),s._v("        "),t("span",{staticClass:"hljs-attr"},[s._v("subscribe")]),s._v(": "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"},[s._v("event, fn")]),s._v(") ")]),s._v("{"),t("br"),s._v("            eventObj[event] = fn;"),t("br"),s._v("        },"),t("br"),s._v("        "),t("span",{staticClass:"hljs-attr"},[s._v("publish")]),s._v(": "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"},[s._v("event")]),s._v(") ")]),s._v("{"),t("br"),s._v("            "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (eventObj[event]) eventObj[event]();"),t("br"),s._v("        },"),t("br"),s._v("        "),t("span",{staticClass:"hljs-attr"},[s._v("off")]),s._v(": "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"},[s._v("event")]),s._v(") ")]),s._v("{"),t("br"),s._v("            "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (eventObj[event]) "),t("span",{staticClass:"hljs-keyword"},[s._v("delete")]),s._v(" eventObj[event];"),t("br"),s._v("        }"),t("br"),s._v("    }"),t("br"),s._v("}());"),t("br"),t("br"),t("span",{staticClass:"hljs-comment"},[s._v("// 测试：")]),t("br"),s._v("PubSub.subscribe("),t("span",{staticClass:"hljs-string"},[s._v("'event'")]),s._v(", "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{"),t("br"),s._v("    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v("'event release'")]),s._v(");"),t("br"),s._v("});"),t("br"),s._v("PubSub.publish("),t("span",{staticClass:"hljs-string"},[s._v("'event'")]),s._v("); "),t("span",{staticClass:"hljs-comment"},[s._v("// 'event release'  ")])])])]),s._v(" "),t("p",[s._v("\n                再优化一下：（支持一个事件绑定多个操作的,并且退订时是退订一个事件上的一个操作,而不是删除整个事件）\n                "),t("pre",{staticClass:"hljs javascript"},[t("code",{},[t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" PubSub = ("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" queue = {};"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" subscribe = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"},[s._v("event, fn")]),s._v(") ")]),s._v("{"),t("br"),s._v("        "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (!queue[event]) queue[event] = [];"),t("br"),s._v("        queue[event].push(fn);"),t("br"),s._v("    }"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" publish = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"},[s._v("event")]),s._v(") ")]),s._v("{"),t("br"),s._v("        "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" eventQueue = queue[event];"),t("br"),s._v("        "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (eventQueue) {"),t("br"),s._v("            eventQueue.forEach("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"},[s._v("item, index")]),s._v(") ")]),s._v("{"),t("br"),s._v("                item();"),t("br"),s._v("            });"),t("br"),s._v("        }"),t("br"),s._v("    }"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" off = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"},[s._v("event, fn")]),s._v(") ")]),s._v("{"),t("br"),s._v("        "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" eventQueue = queue[event];"),t("br"),s._v("        "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (eventQueue) {"),t("br"),s._v("            queue[event] = eventQueue.filter("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"},[s._v("item")]),s._v(") ")]),s._v("{"),t("br"),s._v("                "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" item !== fn;"),t("br"),s._v("            });"),t("br"),s._v("        }"),t("br"),s._v("    }"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" {"),t("br"),s._v("        "),t("span",{staticClass:"hljs-attr"},[s._v("subscribe")]),s._v(": subscribe,"),t("br"),s._v("        "),t("span",{staticClass:"hljs-attr"},[s._v("publish")]),s._v(": publish,"),t("br"),s._v("        "),t("span",{staticClass:"hljs-attr"},[s._v("off")]),s._v(": off"),t("br"),s._v("    }"),t("br"),s._v("}());"),t("br"),t("br"),t("span",{staticClass:"hljs-comment"},[s._v("// 测试：")]),t("br"),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("first")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{"),t("br"),s._v("    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v("'event a publish first'")]),s._v(");"),t("br"),s._v("}"),t("br"),s._v("PubSub.subscribe("),t("span",{staticClass:"hljs-string"},[s._v("'a'")]),s._v(", first);  "),t("br"),s._v("PubSub.subscribe("),t("span",{staticClass:"hljs-string"},[s._v("'a'")]),s._v(", "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{  "),t("br"),s._v("    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v("'event a publish second'")]),s._v(");"),t("br"),s._v("});"),t("br"),s._v("PubSub.publish("),t("span",{staticClass:"hljs-string"},[s._v("'a'")]),s._v("); "),t("span",{staticClass:"hljs-comment"},[s._v("// event a emit first, event a emit second")]),t("br"),t("br"),s._v("PubSub.off("),t("span",{staticClass:"hljs-string"},[s._v("'a'")]),s._v(", first);  "),t("br"),s._v("PubSub.publish("),t("span",{staticClass:"hljs-string"},[s._v("'a'")]),s._v(");  "),t("span",{staticClass:"hljs-comment"},[s._v("//event a emit second   ")])])])])])])],1)},[],!1,null,null,null);l.options.__file="publish-subscribe-pattern.vue";a.default=l.exports}}]);