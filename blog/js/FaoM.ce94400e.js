(window.webpackJsonp=window.webpackJsonp||[]).push([["FaoM"],{FaoM:function(s,a,t){"use strict";t.r(a);var l={},v=t("psIG"),_=Object(v.a)(l,function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"blog-container"},[t("BlogHeader"),s._v(" "),t("BlogContent",{attrs:{useCatalog:!0}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("h2",[s._v("基本概念")]),s._v(" "),t("p",[t("ul",[t("li",[s._v("深拷贝和浅拷贝只针对像Object, Array这样的"),t("code",[s._v("引用类型数据")])]),s._v(" "),t("li",[s._v("浅拷贝是对对象引用地址进行拷贝，拷贝后，改其中一个对象的属性，则源对象的属性也会改变")]),s._v(" "),t("li",[s._v("深拷贝会新开一个引用地址进行拷贝，拷贝后，修改一个对象的属性，不会改变源对象的属性")])])]),s._v(" "),t("h2",[s._v("一个简单的浅拷贝的例子")]),s._v(" "),t("p",[t("pre",{staticClass:"hljs javascript"},[t("code",{},[t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" obj = {a:"),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(", b:"),t("span",{staticClass:"hljs-number"},[s._v("2")]),s._v("};"),t("br"),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" obj2 = obj;"),t("br"),s._v("obj2.a = "),t("span",{staticClass:"hljs-number"},[s._v("3")]),s._v(";"),t("br"),s._v("console."),t("span",{staticClass:"hljs-built_in"},[s._v("log")]),s._v("(obj.a); "),t("span",{staticClass:"hljs-comment"},[s._v("// 3")])])]),s._v("\n                很多情况下，这不是我们想要的。那么深拷贝会怎么做？\n            ")]),s._v(" "),t("h2",[s._v("修改浅拷贝的例子")]),s._v(" "),t("p",[t("pre",{staticClass:"hljs javascript"},[t("code",{},[t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" obj = "),t("span",{staticClass:"hljs-comment"},[s._v("{a:1, b:2}")]),s._v(";"),t("br"),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" obj2 = "),t("span",{staticClass:"hljs-keyword"},[s._v("Object")]),s._v(".assign("),t("span",{staticClass:"hljs-comment"},[s._v("{}")]),s._v(", obj);"),t("br"),s._v("obj2.a = "),t("span",{staticClass:"hljs-number"},[s._v("3")]),s._v(";"),t("br"),s._v("console.log(obj.a); "),t("span",{staticClass:"hljs-comment"},[s._v("// 1")]),t("br")])]),s._v("Ok，改变了obj2的a属性，但obj的a并没有发生变化，这是我们想要的。"),t("br"),s._v("\n                可是这样的深拷贝，还有瑕疵，并没有彻底解决问题。\n            ")]),s._v(" "),t("h2",[s._v("进一步改进深拷贝")]),s._v(" "),t("p",[s._v("\n                看下面这个例子：\n                "),t("pre",{staticClass:"hljs javascript"},[t("code",{},[s._v("const arr = [{a:"),t("span",{staticClass:"hljs-type"},[s._v("1")]),s._v(",b:"),t("span",{staticClass:"hljs-type"},[s._v("2")]),s._v("}, {a:"),t("span",{staticClass:"hljs-type"},[s._v("3")]),s._v(",b:"),t("span",{staticClass:"hljs-type"},[s._v("4")]),s._v("}];"),t("br"),s._v("const "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Arr")]),s._v(" = [].concat(arr);"),t("br"),t("br"),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Arr")]),s._v(".length = "),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v("; "),t("span",{staticClass:"hljs-comment"},[s._v("// 为了方便区分，只保留新数组的第一个元素")]),t("br"),s._v("console.log("),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Arr")]),s._v("); "),t("span",{staticClass:"hljs-comment"},[s._v("// [{a:1,b:2}]")]),t("br"),s._v("console.log(arr); "),t("span",{staticClass:"hljs-comment"},[s._v("// [{a:1,b:2},{a:3,b:4}]")]),t("br"),t("br"),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Arr")]),s._v("["),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("].a = "),t("span",{staticClass:"hljs-number"},[s._v("123")]),s._v("; "),t("span",{staticClass:"hljs-comment"},[s._v("// 修改newArr中第一个元素的a")]),t("br"),s._v("console.log(arr["),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("]); "),t("span",{staticClass:"hljs-comment"},[s._v("// {a: 123, b: 2}，竟然把arr的第一个元素的a也改了")])])]),s._v("\n                这不是我想要的...可是，为什么会这样？"),t("br"),t("br"),s._v("\n                解析："),t("br"),s._v("\n                Object的assign方法、Array的concat和slice等方法，都存在一个问题。"),t("br"),s._v(" "),t("code",[s._v("只会拷贝第一层的值，对于第一层的值都是深拷贝，而到第二层的时候就是 复制引用。")])]),s._v(" "),t("p",[s._v("\n                所以，自己封装个深拷贝的方法：\n                "),t("pre",{staticClass:"hljs javascript"},[t("code",{},[t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("deepClone")])]),s._v("(obj){"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v("(!obj && typeof obj !== "),t("span",{staticClass:"hljs-string"},[s._v("'object'")]),s._v("){"),t("br"),s._v("        "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(";"),t("br"),s._v("    }"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Obj")]),s._v("= toString.call(obj) === "),t("span",{staticClass:"hljs-string"},[s._v("'[object Array]'")]),s._v(" ? [] : "),t("span",{staticClass:"hljs-type"}),s._v("{};"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" key "),t("span",{staticClass:"hljs-keyword"},[s._v("in")]),s._v(" obj) {"),t("br"),s._v("        "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (obj[key] && typeof obj[key] === "),t("span",{staticClass:"hljs-string"},[s._v("'object'")]),s._v(") {"),t("br"),s._v("            "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Obj")]),s._v("[key] = deepClone(obj[key]);"),t("br"),s._v("        } "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" {"),t("br"),s._v("            "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Obj")]),s._v("[key] = obj[key];"),t("br"),s._v("        }"),t("br"),s._v("    }"),t("br"),s._v("    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Obj")]),s._v(";"),t("br"),s._v("}")])])]),s._v(" "),t("p",[s._v("\n                再试试看：\n                "),t("pre",{staticClass:"hljs javascript"},[t("code",{},[s._v("let arr = [{a:"),t("span",{staticClass:"hljs-type"},[s._v("1")]),s._v(",b:"),t("span",{staticClass:"hljs-type"},[s._v("2")]),s._v("}, {a:"),t("span",{staticClass:"hljs-type"},[s._v("3")]),s._v(",b:"),t("span",{staticClass:"hljs-type"},[s._v("4")]),s._v("}];"),t("br"),s._v("let "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Arr")]),s._v(" = deepClone(arr);"),t("br"),t("br"),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Arr")]),s._v(".length = "),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v("; "),t("span",{staticClass:"hljs-comment"},[s._v("// 为了方便区分，只保留新数组的第一个元素")]),t("br"),s._v("console.log("),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Arr")]),s._v("); "),t("span",{staticClass:"hljs-comment"},[s._v("// [{a:1,b:2}]")]),t("br"),s._v("console.log(arr); "),t("span",{staticClass:"hljs-comment"},[s._v("// [{a:1,b:2},{a:3,b:4}]")]),t("br"),t("br"),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),t("span",{staticClass:"hljs-type"},[s._v("Arr")]),s._v("["),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("].a = "),t("span",{staticClass:"hljs-number"},[s._v("123")]),s._v("; "),t("span",{staticClass:"hljs-comment"},[s._v("// 修改newArr中第一个元素的a")]),t("br"),s._v("console.log(arr["),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("]); "),t("span",{staticClass:"hljs-comment"},[s._v("// {a:1, b:2}")])])]),s._v("\n                ok，这下搞定了。\n            ")]),s._v(" "),t("h2",[s._v("更简单粗暴的办法")]),s._v(" "),t("p",[s._v("\n                把array用json转成string，再转回来。像这样：\n                "),t("pre",{staticClass:"hljs javascript"},[t("code",{},[t("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" newArr2 = "),t("span",{staticClass:"hljs-built_in"},[s._v("JSON")]),s._v(".parse("),t("span",{staticClass:"hljs-built_in"},[s._v("JSON")]),s._v(".stringify(arr));"),t("br"),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(arr["),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("]); "),t("span",{staticClass:"hljs-comment"},[s._v("// {a:1,b:2}")]),t("br"),s._v("newArr2["),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("].a = "),t("span",{staticClass:"hljs-number"},[s._v("123")]),s._v(";"),t("br"),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(arr["),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("]); "),t("span",{staticClass:"hljs-comment"},[s._v("// {a:1,b:2}")])])])])])])],1)},[],!1,null,null,null);_.options.__file="copy-object-in-javascript.vue";a.default=_.exports}}]);