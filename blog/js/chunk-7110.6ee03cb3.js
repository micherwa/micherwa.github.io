(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7110"],{"+/q5":function(s,t,n){s.exports=n.p+"assets/bg-20190928-14.4bff876.jpg"},"2UsK":function(s,t,n){s.exports=n.p+"assets/bg-20190928-16.f0aacbb.png"},"898P":function(s,t,n){s.exports=n.p+"assets/bg-20190928-12.d36efe1.png"},P3aY:function(s,t,n){s.exports=n.p+"assets/bg-20190928-01.858304d.png"},"Tu/m":function(s,t,n){s.exports=n.p+"assets/bg-20190928-13.856999e.png"},cDz5:function(s,t){s.exports="data:image/png;base64,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"},vgxJ:function(s,t,n){"use strict";n.r(t);var a={},i=n("psIG"),l=Object(i.a)(a,function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"blog-container"},[a("BlogHeader"),s._v(" "),a("BlogContent",[a("div",{attrs:{slot:"content"},slot:"content"},[a("h2",[s._v("前言")]),s._v(" "),a("p",[s._v("\n                    接上一篇文章 "),a("a",{attrs:{href:"https://juejin.im/post/5da146316fb9a04def4e6327",target:"_blank"}},[s._v("《「干货」用 Vue + Echarts 打造你的专属可视化界面（上）》")]),s._v("，今天着重介绍 "),a("code",[s._v("标记")]),s._v(" 的用法，来实现下图中的效果。\n                    "),a("img",{attrs:{src:n("P3aY")}})]),s._v(" "),a("p",[s._v("\n                    所用的 Echarts 的版本号为： v4.3。v-charts 的版本号为：v1.19.0。\n                ")]),s._v(" "),a("p",[s._v("标记的用法有很多，今天要介绍的场景有：折线图、柱状图、折线图 + 柱状图。")]),s._v(" "),a("h2",[s._v("折线图标记 —— symbol")]),s._v(" "),a("p",[s._v("\n                    上图中，折线的拐点处，一些 “小圆点”，被替换成了小图标。\n                ")]),s._v(" "),a("p",[s._v("\n                    要实现这样的效果，需要先理一下原始的需求：\n                    "),a("ul",[a("li",[s._v("每种标记，代表一种活动类型。")]),s._v(" "),a("li",[s._v("有一些活动会发生在某些时间点，或时间段内，需要在活动发生的日期上标注出该活动的类型。")]),s._v(" "),a("li",[s._v("当同一天有多个活动发生时，采用复合图标，并当展示 tooltip 时，显示当日的每一个活动的信息。")]),s._v(" "),a("li",[s._v("tooltip的布局为：首先显示当前日期，中段展示各个活动的图标以及活动名称，最后展示指标名称和对应的数值。")]),s._v(" "),a("li",[s._v("没有活动的日期，拐点处与 tooltip 照常显示原先的样式。")])]),s._v("\n                    所以，它的完整效果，应该是这样的：\n                    "),a("img",{attrs:{src:n("898P")}})]),s._v(" "),a("p",[s._v("\n                    要实现这样的效果，需要思考以下几点：\n                    "),a("ul",[a("li",[s._v("如何通过日期的定向匹配，将活动的图标以“打点”的形式，定在折线拐点处。")]),s._v(" "),a("li",[s._v("图标的大小，要怎么设置？它需要区别于正常的拐点标识。")]),s._v(" "),a("li",[s._v("tooltip 的样式要如何改写？还需要兼容没有活动的日期样式。")])])]),s._v(" "),a("p",[s._v("思路解析：")]),s._v(" "),a("p",[s._v("\n                    首先，为了做日期的定向匹配，需要设计的数据结构如下：\n                    "),a("pre",[a("code",{staticClass:"hljs bash",attrs:{lang:"bash"}},[s._v("data: [\n    {\n        id: "),a("span",{staticClass:"hljs-string"},[s._v("'1, 1, 3, 2'")]),s._v(",\n        date: "),a("span",{staticClass:"hljs-string"},[s._v("'2019-10-10'")]),s._v(",\n        name: "),a("span",{staticClass:"hljs-string"},[s._v("'test-name1, test-name2, test-name3, test-name4'")]),s._v("\n    },\n    ...\n]\n")])]),s._v("\n                    接下来的这个 "),a("strong",[s._v("核心")]),s._v(" 属性："),a("code",[s._v("symbol")]),s._v(" 是关键，它其实就是折线上的 "),a("code",[s._v("拐点")]),s._v("。\n                ")]),s._v(" "),a("p",[s._v("\n                    symbol 支持的标记类型有：circle、rect、roundRect、triangle、diamond、pin、arrow、none。默认情况下为 emptyCircle，也就是空心的圆。\n                ")]),s._v(" "),a("p",[s._v("\n                    它还支持链接的格式："),a("code",[s._v("'image://http://xxx.xxx.xxx/a/b.png'")]),s._v("。此外，如果需要每个数据的图形不一样，可以设置为如下格式的回调函数：\n                    "),a("pre",[a("code",{staticClass:"hljs bash",attrs:{lang:"bash"}},[s._v("(value: Array|number, params: Object) => string\n")])]),s._v("\n                    其中第一个参数 value 为 data 中的数据值。第二个参数 params 是其它的数据项参数。\n                ")]),s._v(" "),a("p",[s._v("\n                    这些正是我们需要的。踩坑亲测：上述回调函数，只有在最新版的 "),a("code",[s._v("V4.3")]),s._v(" 中才能正常使用，否则会报错。这也是为何，我在一开始就先强调了 Echarts 的版本问题。具体实现如下：\n                    "),a("pre",[a("code",{staticClass:"hljs bash",attrs:{lang:"bash"}},[s._v("<ve-line ... :extend="),a("span",{staticClass:"hljs-string"},[s._v('"chartExtend"')]),s._v("></ve-line>\n...\n\n// mock 包含标注的数据结构\ndataList: [\n    {\n        id: "),a("span",{staticClass:"hljs-string"},[s._v("'1, 1, 3, 2'")]),s._v(",\n        date: "),a("span",{staticClass:"hljs-string"},[s._v("'2019-10-10'")]),s._v(",\n        name: "),a("span",{staticClass:"hljs-string"},[s._v("'test-name1, test-name2, test-name3, test-name4'")]),s._v("\n    },\n    ...\n    {\n        id: "),a("span",{staticClass:"hljs-string"},[s._v("'1'")]),s._v(",\n        date: "),a("span",{staticClass:"hljs-string"},[s._v("'2019-10-17'")]),s._v(",\n        name: "),a("span",{staticClass:"hljs-string"},[s._v("'test-name1'")]),s._v("\n    }\n],\n...\n\n"),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-title"},[s._v("setChartExtend")])]),s._v(" () {\n    this.chartExtend = {\n        series: (v) => {\n            Array.from(v).forEach((e, idx) => {\n                e.symbol = (value, params) => {\n                    "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" getSymbolIcon(params.name, dataList);\n                };\n                e.symbolSize = (value, params) => {\n                    "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" getSymbolSize(params.name, dataList);\n                };\n            });\n            "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" v;\n        },\n        ...\n    };\n},\n\ngetSymbolIcon (date, dataList) {\n    const defaultSymbol = "),a("span",{staticClass:"hljs-string"},[s._v("'circle'")]),s._v(";\n\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (!dataList || dataList.length === 0) {\n        "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" defaultSymbol;\n    }\n\n    // 通过日期匹配，找到对应的标注对象\n    const dataItem = dataList.find(item => item.date === date);\n\n    const iconUrl = getSymbolUrl(dataItem.id);\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" iconUrl ? iconUrl : defaultSymbol;\n},\n\ngetSymbolSize (date, dataList) {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (!dataList || dataList.length === 0) {\n        "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" 4;\n    }\n\n    // 通过日期匹配，找到对应的标注对象\n    const dataItem = dataList.find(item => item.date === date);\n\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" dataItem ? 15 : 4;\n},\n\ngetSymbolUrl (id) {\n    // 这里需要额外先做一层准备工作：将图标按 id 对应图标进行命名，然后传到自家的cdn上\n    // 命名可以像这样：symbol-icon-1.jpg、symbol-icon-2.jpg 等等\n    // 这里拿到标注的id，拼上链接返回即可\n    // 形如：image://http://xxx.xxx.com/symbol-icon-1.jpg\n    // 遇到多个 id 的情况，可以多加一个复合图标来处理，id 可以定为 0\n}\n\n")])])]),s._v(" "),a("p",[s._v("\n                    最后的一个问题，如何改写 tooltip 的样式问题，以做好兼容呢？\n                ")]),s._v(" "),a("p",[s._v("\n                    之前说到，tooltip 的布局分为三块：日期、标注信息、具体数值。那么我们就以此，来重新绘制 tooltip。\n                    "),a("img",{attrs:{src:n("Tu/m")}})]),s._v(" "),a("p",[s._v("\n                    tooltip 支持 formatter 回调函数，它的返回值类型是 Sting。\n                    "),a("pre",[a("code",{staticClass:"hljs bash",attrs:{lang:"bash"}},[s._v("// 回调函数格式\n(params: Object|Array, ticket: string, callback: (ticket: string, html: string)) => string\n")])]),s._v("\n                    日期的信息，可以通过 params[0].axisValue 来获取。\n                ")]),s._v(" "),a("p",[s._v("获取标注信息的方法，与上述获取图标的思路类似，只是这里需要展示具体的标注类型和名称。")]),s._v(" "),a("p",[s._v("\n                    具体的数值，可以通过 params 中的 marker，seriesName，value 等属性获得。具体实现如下：\n                    "),a("pre",[a("code",{staticClass:"hljs bash",attrs:{lang:"bash"}},[a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-title"},[s._v("setChartExtend")])]),s._v(" () {\n    this.chartExtend = {\n        series: (v) => {\n            ...\n        },\n        tooltip: {\n            formatter: (params) => {\n                "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" getTooltipResult(params, dataList);\n            }\n        }\n    };\n},\n\ngetTooltipResult (params, dataList) {\n    const dateResult = params[0].axisValue;\n    // 获取原版 tooltip 的渲染结构\n    const originalResultObj = getOriginalTooltipResult(params);\n\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (!dataList || dataList.length === 0) {\n        "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" dateResult + originalResultObj.strResult;\n    }\n\n    const dataItem = dataList.find(item => item.date === date);\n\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (dataItem) {\n        "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" dateResult +  getSymbolResult(dataItem, originalResultObj.strResult);\n    }\n\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" dateResult + originalResultObj.strResult;\n},\n\ngetOriginalTooltipResult (params) {\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("let")]),s._v(" result = "),a("span",{staticClass:"hljs-string"},[s._v("''")]),s._v(";\n\n    params.forEach((param, idx) => {\n        // value 会因为 seriesType 的不同，类型也会有不同\n        "),a("span",{staticClass:"hljs-built_in"},[s._v("let")]),s._v(" value = Object.prototype.toString.call(param.value) === "),a("span",{staticClass:"hljs-string"},[s._v("'[object Array]'")]),s._v(" ? param.value[1] : param.value;\n\n        const str = `"),a("span",{staticClass:"hljs-variable"},[s._v("${param.marker}")]),a("span",{staticClass:"hljs-variable"},[s._v("${param.seriesName}")]),s._v(": "),a("span",{staticClass:"hljs-variable"},[s._v("${ value }")]),s._v("<br>`;\n        result += str;\n    });\n\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" {\n        strResult: result\n    };\n},\n\ngetSymbolResult (dataItem, originalResult) {\n    // 将 dataItem 的 id 转为数组的形式，循环渲染输出图标与名称的组合\n    const dataIds = dataItem.id.split("),a("span",{staticClass:"hljs-string"},[s._v("','")]),s._v(");\n    const dataNames = dataItem.name.split("),a("span",{staticClass:"hljs-string"},[s._v("','")]),s._v(");\n\n    dataIds.forEach ((id, idx) => {\n        // 通过 id 换取 图标的链接\n        const iconUrl = ...;\n\n        // 仿照 param.marker 的 style 写法，渲染图标样式\n        const str = `<img src="),a("span",{staticClass:"hljs-string"},[s._v('"'),a("span",{staticClass:"hljs-variable"},[s._v("${iconUrl}")]),s._v('"')]),s._v(" width="),a("span",{staticClass:"hljs-string"},[s._v('"11"')]),s._v(" height="),a("span",{staticClass:"hljs-string"},[s._v('"11"')]),s._v(" style="),a("span",{staticClass:"hljs-string"},[s._v('"display: inline-block; margin-right: 4px; margin-left: -1px;"')]),s._v(">"),a("span",{staticClass:"hljs-variable"},[s._v("${dataNames[idx]}")]),s._v("<br>`;\n\n        result += str;\n    });\n\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" result + originalResult;\n}\n")])]),s._v("\n                或许有同学会问 getOriginalTooltipResult 方法返回的值，里面只有一个 strResult，为何要设计为对象？\n                ")]),s._v(" "),a("p",[s._v("\n                    其实是为了方便扩展。例如，可以在日期的后面跟上下方具体数据的值的总计。那就需要通过 getOriginalTooltipResult 方法里的 params 循环，计算出 total，在配合上样式，生成一个 strTotal。\n                    "),a("pre",[a("code",{staticClass:"hljs bash",attrs:{lang:"bash"}},[s._v("getOriginalTooltipResult (params) {\n    ...\n\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" {\n        strTotal: strTotal,\n        strResult: result\n    };\n}\n\n")])]),s._v("\n                    此外，在实际的业务中，还可能会出现某些线的数值是百分比。那就需要再对 getOriginalTooltipResult 方法做扩展，比如传入一个 options 对象：\n                    "),a("pre",[a("code",{staticClass:"hljs bash",attrs:{lang:"bash"}},[s._v("getOriginalTooltipResult = (params, options = { isLinePercent: "),a("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(", isShowTotal: "),a("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(" }) {\n    ...\n}\n")])]),s._v("\n                    至此，折线图标记的渲染，就能完美地呈现了。\n                ")]),s._v(" "),a("h2",[s._v("柱状图标记 —— markPoint")]),s._v(" "),a("p",[s._v("\n                    很尴尬的一点是：柱状图没有 symbol 属性。也就意味着上面的折线图的那一套，在柱状图中玩不转了。\n                    "),a("img",{attrs:{src:n("+/q5")}}),s._v("\n                    没办法，只能从头查文档，继续找资料。经过一番“摸爬滚打”，终于发现了 markPoint 这个属性。在 markPoint 这个对象里面，可以设置 symbol，这样的话，那么之前搞出来的那一套就没有白费呀？！？\n                ")]),s._v(" "),a("p",[s._v("\n                    需要注意的是，markPoint 的默认 symbol 为 'pin'，就是一个气泡的图标。另外，想要让 markPoint 的标记出现，就必须设置它的 data 属性。我们需要设置 data 里的这样几个属性：\n                    "),a("pre",[a("code",{staticClass:"hljs bash",attrs:{lang:"bash"}},[s._v("data: [\n    {\n        symbol: "),a("span",{staticClass:"hljs-string"},[s._v("'...'")]),s._v(", // 设置标记的图标链接\n        symbolSize: 15, // 设置标记的大小\n        coord: [index, 0], // x 轴的第 index 个上，打标记\n        symbolOffset: [0, 0] // 将标记定位在 x 轴上\n    },\n    ...\n]\n")])])]),s._v(" "),a("p",[s._v("\n                    具体的实现代码如下：\n                    "),a("pre",[a("code",{staticClass:"hljs bash",attrs:{lang:"bash"}},[s._v("<ve-histogram :data="),a("span",{staticClass:"hljs-string"},[s._v('"chartData"')]),s._v(" :extend="),a("span",{staticClass:"hljs-string"},[s._v('"chartExtend"')]),s._v("></ve-histogram>\n...\n\n// mock 包含标注的数据结构\ndataList: [\n    {\n        id: "),a("span",{staticClass:"hljs-string"},[s._v("'1, 1, 3, 2'")]),s._v(",\n        date: "),a("span",{staticClass:"hljs-string"},[s._v("'2019-10-10'")]),s._v(",\n        name: "),a("span",{staticClass:"hljs-string"},[s._v("'test-name1, test-name2, test-name3, test-name4'")]),s._v("\n    },\n    ...\n    {\n        id: "),a("span",{staticClass:"hljs-string"},[s._v("'1'")]),s._v(",\n        date: "),a("span",{staticClass:"hljs-string"},[s._v("'2019-10-17'")]),s._v(",\n        name: "),a("span",{staticClass:"hljs-string"},[s._v("'test-name1'")]),s._v("\n    }\n],\n...\n\n"),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-title"},[s._v("setChartExtend")])]),s._v(" () {\n    this.chartExtend = {\n        series: (v) => {\n            Array.from(v).forEach((e, idx) => {\n                e.markPoint = {\n                    data: getMarkPointData(this.chartData.rows, dataList)\n                };\n            });\n        },\n        ...\n    };\n},\n\ngetMarkPointData (rows, dataList) {\n    const results = [];\n\n    rows.forEach((row, index) => {\n        // 通过日期匹配，找到对应的标注对象\n        const dataItem = dataList.find(item => item.date === row.date);\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (dataItem) {\n            results.push({\n                symbol: getSymbolUrl(dataItem.id),\n                symbolSize: 15,\n                coord: [index, 0],\n                symbolOffset: [0, 0]\n            });\n        }\n    });\n\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("return")]),s._v(" results;\n},\n\ngetSymbolUrl (id) {\n    // 这里需要额外先做一层准备工作：将图标按 id 对应图标进行命名，然后传到自家的cdn上\n    // 命名可以像这样：symbol-icon-1.jpg、symbol-icon-2.jpg 等等\n    // 这里拿到标注的id，拼上链接返回即可\n    // 形如：image://http://xxx.xxx.com/symbol-icon-1.jpg\n    // 遇到多个 id 的情况，可以多加一个复合图标来处理，id 可以定为 0\n}\n\n")])]),s._v("\n                    因为 markPoint 在设置 data 时，取不到日期的数据，所以就需要用到 chartData 中的 rows 了。\n                ")]),s._v(" "),a("p",[s._v("\n                    在 rows 的循环中，如果匹配到当天需要打标记，则往结果数组中存入刚才预设的数据结构，最终返回给 markPoint 的 data，渲染展现。效果如下：\n                    "),a("img",{attrs:{src:n("cDz5")}}),s._v("\n                    tooltip 的实现方法，不受图表的类型影响，是可以通用的，故此处不再赘述。\n                ")]),s._v(" "),a("p",[s._v("\n                    另外，有的时候，会遇到需要处理柱状图是否堆叠的效果。这会影响 symbolOffset 的定位，为了美观，可以这样处理：对于非堆叠的项，将之往右偏移 50%，将标记居中展示，即 "),a("code",[s._v("symbolOffset : ['50%', 0]")]),s._v("。\n                ")]),s._v(" "),a("h2",[s._v("折线图 + 柱状图")]),s._v(" "),a("p",[s._v("\n                    最后来个 "),a("strong",[s._v("组合拳")]),s._v("，折线图与柱状图的复合型图表结构，像下面这样：\n                    "),a("img",{attrs:{src:n("2UsK")}}),s._v("\n                    从代码实现上，我们当然可以给每一根符合条件的柱子，和折线的拐点，都打上标记。但在界面设计上，为了美观，我们选择只给折线的拐点打上标记，并且忽略了虚线的拐点。\n                ")]),s._v(" "),a("p",[s._v("\n                    这样的设计初衷是：标记，只是为了给人提个醒，是为了告诉查阅者，这一天因为发生了某些特殊事件，而导致数据发生了较为明显的变化。所以，由此得到的结论是：每天只要出现一个标记就够了。\n                ")]),s._v(" "),a("p",[s._v("\n                    具体的实现，其实很简单，只需要在渲染时判断 series 的 type 即可：\n                    "),a("pre",[a("code",{staticClass:"hljs bash",attrs:{lang:"bash"}},[a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-title"},[s._v("setChartExtend")])]),s._v(" () {\n    this.chartExtend = {\n        series: (v) => {\n            Array.from(v).forEach((e, idx) => {\n                "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (e.type === "),a("span",{staticClass:"hljs-string"},[s._v("'bar'")]),s._v(") {\n                    // 设置柱状图 markPoint 的方法\n                    ...\n                }\n\n                "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (e.type === "),a("span",{staticClass:"hljs-string"},[s._v("'line'")]),s._v(") {\n                    // 设置折线图 symbol、symbolSize 的方法\n                    ...\n                }\n            });\n        },\n        ...\n    };\n}\n")])])]),s._v(" "),a("h2",[s._v("总结")]),s._v(" "),a("p",[s._v("\n                    Echarts 可以实现的效果有很多，本篇涉及其中 “标记” 的渲染。在折线图的拐点处，用 symbol 做了匹配化的处理。在柱状图中，因为没有直接的 symbol，转而使用 markPoint 来实现，采用将标记定位在某个维度上的做法。效果都挺不错的。\n                ")]),s._v(" "),a("p",[s._v("\n                    不过，在后续的使用中，发现了另一个尴尬的情况："),a("code",[s._v("在折线图中，当点击图例中的某一项，使其数据隐藏，然后再次点击重新渲染后，发现 symbol 的自定义图标不显示了。")])]),s._v(" "),a("p",[s._v("\n                    我查了很久，还是没找到有用的信息。怀疑是个渲染的 bug，所以给 Echarts 提了 issue，希望能得到解决吧。也欢迎大家在留言区中，共同探讨相关的问题，感谢！\n                ")])])])],1)},[],!1,null,null,null);l.options.__file="skills-of-echarts-in-vue-2.vue";t.default=l.exports}}]);